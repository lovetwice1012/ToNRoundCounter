# ラウンドデータ同期機能仕様書

## 1. 機能概要
ローカルで記録されたラウンドデータをクラウドと同期し、複数デバイス間でのデータ共有を実現する。

## 2. 要件定義

### 2.1 必須要件
- ラウンドの開始/終了情報をリアルタイムでクラウドへ送信
- ラウンド中の状態変更（生存者数、テラー出現等）の同期
- 過去のラウンドデータの参照機能
- オフライン時のデータキャッシュと再同期機能

### 2.2 オプション要件
- データ圧縮による通信量削減
- 差分同期によるパフォーマンス最適化
- 複数インスタンス間のデータ整合性確保

## 3. 技術仕様

### 3.1 データ構造
```json
{
  "roundId": "string",
  "startTime": "datetime",
  "endTime": "datetime",
  "status": "enum(ACTIVE, COMPLETED, CANCELLED)",
  "survivorCount": "number",
  "terrorAppearances": [
    {
      "terrorId": "string",
      "appearanceTime": "datetime"
    }
  ],
  "events": [
    {
      "type": "enum",
      "timestamp": "datetime",
      "data": "object"
    }
  ]
}
```

### 3.2 通信プロトコル
- WebSocket: リアルタイムデータ同期用
- REST API: 過去データ取得・一括同期用

### 3.3 同期プロセス
1. ラウンド開始時にWebSocket接続確立
2. 状態変更をリアルタイムでプッシュ通知
3. 定期的なハートビートでコネクション維持
4. 切断時は自動再接続を試行

## 4. エラー処理

### 4.1 ネットワークエラー
- 接続断時のローカルキャッシュ保存
- 再接続時の差分データ同期
- タイムアウト時の再試行ロジック

### 4.2 データ整合性エラー
- チェックサムによるデータ検証
- 不整合検出時の完全再同期
- コンフリクト解決ロジック

## 5. セキュリティ

### 5.1 データ保護
- 通信の暗号化（TLS 1.3）
- データアクセス制御
- 認証トークンの管理

### 5.2 アクセス制御
- ユーザー認証必須
- 権限ベースのアクセス制御
- セッション管理

## 6. パフォーマンス要件
- リアルタイム同期の遅延: 1秒以内
- オフラインキャッシュサイズ: 最大100MB
- 同時接続数: 最大10クライアント