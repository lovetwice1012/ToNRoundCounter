# å”åŠ›å‹ç”Ÿå­˜ã‚·ã‚¹ãƒ†ãƒ  è¦ä»¶å®šç¾©æ›¸ãƒ»ä»•æ§˜è¨­è¨ˆæ›¸

**æœ€çµ‚æ›´æ–°:** 2025å¹´11æœˆ5æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 2.0  
**å¯¾è±¡:** ToNRoundCounter ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤å”åŠ›ãƒ—ãƒ¬ã‚¤æ©Ÿèƒ½

> **âš ï¸ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã«é–¢ã™ã‚‹æ³¨æ„**  
> æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ…‹ï¼ˆHPã€ä½ç½®ã€ã‚¢ã‚¤ãƒ†ãƒ ã€ç”Ÿå­˜çŠ¶æ…‹ãªã©ï¼‰ã‚’  
> ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…ã®ä»–ã®ToNRoundCounterãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨å…±æœ‰ã—ã¾ã™ã€‚  
> è©³ç´°ã¯ [ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼](../PRIVACY_POLICY.md) ã‚’ã”ç¢ºèªãã ã•ã„ã€‚

---

## ğŸ“‹ ç›®æ¬¡

1. [åŸºæœ¬ã‚³ãƒ³ã‚»ãƒ—ãƒˆ](#åŸºæœ¬ã‚³ãƒ³ã‚»ãƒ—ãƒˆ)
2. [è¦ä»¶å®šç¾©](#è¦ä»¶å®šç¾©)
3. [ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹](#ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹)
4. [ã»ã—ã„ãƒ†ãƒ©ãƒ¼è¨­å®šä»•æ§˜](#ã»ã—ã„ãƒ†ãƒ©ãƒ¼è¨­å®šä»•æ§˜)
5. [ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤](#ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤)
6. [çµ±ç‡è‡ªå‹•è‡ªæ®ºã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#çµ±ç‡è‡ªå‹•è‡ªæ®ºã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
7. [ã‚·ã‚¹ãƒ†ãƒ å‡¦ç†ãƒ•ãƒ­ãƒ¼](#ã‚·ã‚¹ãƒ†ãƒ å‡¦ç†ãƒ•ãƒ­ãƒ¼)
8. [UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](#uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
9. [å®Ÿè£…ä»•æ§˜](#å®Ÿè£…ä»•æ§˜)
10. [ãƒ†ã‚¹ãƒˆä»•æ§˜](#ãƒ†ã‚¹ãƒˆä»•æ§˜)

---

## ğŸ¯ åŸºæœ¬ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

```
ç”Ÿå­˜ç‡ï¼ˆçµ±è¨ˆçš„ãƒªã‚¹ã‚¯ï¼‰ã‚’è¦‹ã›ã‚‹ã®ã§ã¯ãªãã€
ã€Œä»Šã€ç”Ÿå­˜ã‚’æœ›ã‚“ã§ã„ã‚‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€ã®å¸Œæœ›ã‚’è¦‹ã›ã¦ã€
ã¿ã‚“ãªã§å”åŠ›ã—ã¦ç”Ÿå­˜ã‚’ç›®æŒ‡ã™ã‚·ã‚¹ãƒ†ãƒ 
```

### ã‚­ãƒ¼æ©Ÿèƒ½

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| **ã»ã—ã„ãƒ†ãƒ©ãƒ¼ç™»éŒ²** | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å„è‡ªãŒã€Œãƒ©ã‚¦ãƒ³ãƒ‰ Ã— ãƒ†ãƒ©ãƒ¼åã€ã§ç”Ÿå­˜å¸Œæœ›ã‚’äº‹å‰ç™»éŒ² |
| **ãƒ†ãƒ©ãƒ¼å‡ºç¾æ™‚ã‚¢ãƒŠã‚¦ãƒ³ã‚¹** | ã€ŒXXã•ã‚“ãŒç”Ÿå­˜å¸Œæœ›ã€ã¨é€šçŸ¥ + ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ |
| **å”åŠ›åˆ¤æ–­** | è‡ªå‹•è‡ªæ®ºè¨­å®šï¼ˆçµ±ç‡/é€šå¸¸/æ‰‹å‹•ï¼‰ã«å¿œã˜ãŸå”åŠ›ãƒ•ãƒ­ãƒ¼ |
| **æŠ•ç¥¨ã‚·ã‚¹ãƒ†ãƒ ** | çµ±ç‡ã•ã‚Œã‚‹è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰æ™‚ã¯æŠ•ç¥¨ã§æ±ºå®šï¼ˆ10ç§’åˆ¶é™ï¼‰ |
| **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º** | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®çŠ¶æ…‹ï¼ˆã‚¢ã‚¤ãƒ†ãƒ ãƒ»ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ»ç”Ÿæ­»ï¼‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º |

---

## ğŸ“– è¦ä»¶å®šç¾©

### æ©Ÿèƒ½è¦ä»¶

#### FR-001: ã»ã—ã„ãƒ†ãƒ©ãƒ¼ç™»éŒ²æ©Ÿèƒ½

**è¦ä»¶:** ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã€Œãƒ©ã‚¦ãƒ³ãƒ‰ Ã— ãƒ†ãƒ©ãƒ¼åã€ã®çµ„ã¿åˆã‚ã›ã§ç”Ÿå­˜å¸Œæœ›ã‚’ç™»éŒ²ã§ãã‚‹

| ID | è¦ä»¶ | å„ªå…ˆåº¦ |
|----|------|--------|
| FR-001-1 | ãƒ©ã‚¦ãƒ³ãƒ‰æŒ‡å®šï¼ˆç‰¹å®šãƒ©ã‚¦ãƒ³ãƒ‰ or ã™ã¹ã¦ã®ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰ | å¿…é ˆ |
| FR-001-2 | ãƒ†ãƒ©ãƒ¼åé¸æŠï¼ˆ15ç¨®é¡ã®ãƒ†ãƒ©ãƒ¼ï¼‰ | å¿…é ˆ |
| FR-001-3 | è¤‡æ•°ç™»éŒ²å¯èƒ½ï¼ˆç„¡åˆ¶é™ï¼‰ | å¿…é ˆ |
| FR-001-4 | å‰Šé™¤æ©Ÿèƒ½ | å¿…é ˆ |
| FR-001-5 | LocalStorageæ°¸ç¶šåŒ– | å¿…é ˆ |
| FR-001-6 | Cloud BackendåŒæœŸ | å¿…é ˆ |

**å—ã‘å…¥ã‚ŒåŸºæº–:**
- âœ… SettingsPanelã‹ã‚‰ç™»éŒ²ãƒ»å‰Šé™¤ãŒå¯èƒ½
- âœ… ãƒ©ã‚¦ãƒ³ãƒ‰ç©ºç™½æ™‚ã¯å…¨ãƒ©ã‚¦ãƒ³ãƒ‰å¯¾è±¡
- âœ… è¨­å®šãŒã‚¢ãƒ—ãƒªå†èµ·å‹•å¾Œã‚‚ä¿æŒã•ã‚Œã‚‹

#### FR-002: ãƒ†ãƒ©ãƒ¼å‡ºç¾æ™‚é€šçŸ¥æ©Ÿèƒ½

**è¦ä»¶:** ç™»éŒ²ã—ãŸãƒ†ãƒ©ãƒ¼ãŒå‡ºç¾æ™‚ã€ç”Ÿå­˜å¸Œæœ›ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¡¨ç¤º

| ID | è¦ä»¶ | å„ªå…ˆåº¦ |
|----|------|--------|
| FR-002-1 | ãƒãƒƒãƒãƒ³ã‚°åˆ¤å®šï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰ Ã— ãƒ†ãƒ©ãƒ¼åï¼‰ | å¿…é ˆ |
| FR-002-2 | ç”Ÿå­˜å¸Œæœ›ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã„ãªã„å ´åˆã¯é€šçŸ¥ãªã— | å¿…é ˆ |
| FR-002-3 | ThreatAlertOverlayè¡¨ç¤º | å¿…é ˆ |
| FR-002-4 | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ | å¿…é ˆ |

**å—ã‘å…¥ã‚ŒåŸºæº–:**
- âœ… ãƒãƒƒãƒã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã¿é€šçŸ¥
- âœ… èª°ã‚‚ç™»éŒ²ã—ã¦ã„ãªã„å ´åˆã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„
- âœ… 10ç§’ä»¥å†…ã«è¡¨ç¤º

#### FR-003: è‡ªå‹•è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰åˆ¥ãƒ•ãƒ­ãƒ¼

**è¦ä»¶:** è‡ªå‹•è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸå‡¦ç†åˆ†å²

| ãƒ¢ãƒ¼ãƒ‰ | ç”Ÿå­˜å¸Œæœ›è€…ã‚ã‚Š | ç”Ÿå­˜å¸Œæœ›è€…ãªã— |
|--------|---------------|---------------|
| **Disabled** | ä½•ã‚‚è¡¨ç¤ºã—ãªã„ | ä½•ã‚‚è¡¨ç¤ºã—ãªã„ |
| **Manual** | é€šçŸ¥ã®ã¿ï¼ˆ3ç§’ï¼‰ | ä½•ã‚‚è¡¨ç¤ºã—ãªã„ |
| **Individual** | ãƒœã‚¿ãƒ³è¡¨ç¤ºï¼ˆ10ç§’ï¼‰ | é€šçŸ¥ã®ã¿ï¼ˆ3ç§’ï¼‰ |
| **Coordinated** | æŠ•ç¥¨ãƒœã‚¿ãƒ³ï¼ˆ10ç§’ï¼‰ | æŠ•ç¥¨ãƒœã‚¿ãƒ³ï¼ˆ10ç§’ï¼‰ |

**å—ã‘å…¥ã‚ŒåŸºæº–:**
- âœ… å„ãƒ¢ãƒ¼ãƒ‰ã§æ­£ã—ã„UIè¡¨ç¤º
- âœ… ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã®æ­£ã—ã„å‡¦ç†
- âœ… è¨­å®šå¤‰æ›´ãŒå³æ™‚åæ˜ 

#### FR-004: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤

**è¦ä»¶:** ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®çŠ¶æ…‹ã‚’è¡¨ç¤º

| ID | è¦ä»¶ | å„ªå…ˆåº¦ |
|----|------|--------|
| FR-004-1 | ç”Ÿå­˜å¸Œæœ›è€…ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆåˆ¥æ ï¼‰ | å¿…é ˆ |
| FR-004-2 | å…¨ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆ | å¿…é ˆ |
| FR-004-3 | è¡¨ç¤º: åå‰:ã‚¢ã‚¤ãƒ†ãƒ (ãƒ€ãƒ¡ãƒ¼ã‚¸) | å¿…é ˆ |
| FR-004-4 | è‰²åˆ†ã‘: ç”Ÿå­˜å¸Œæœ›è€…ï¼ˆç·‘/èµ¤ï¼‰ã€ãã®ä»–ï¼ˆç™½/ç°è‰²ï¼‰ | å¿…é ˆ |
| FR-004-5 | 200msæ›´æ–° | å¿…é ˆ |

**å—ã‘å…¥ã‚ŒåŸºæº–:**
- âœ… ç”Ÿå­˜æ™‚ã¨æ­»äº¡å¾Œã§è‰²ãŒå¤‰ã‚ã‚‹
- âœ… ãƒ€ãƒ¡ãƒ¼ã‚¸ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°
- âœ… ã‚¢ã‚¤ãƒ†ãƒ å¤‰æ›´ãŒå³æ™‚åæ˜ 

#### FR-005: çµ±ç‡è‡ªå‹•è‡ªæ®ºæŠ•ç¥¨ã‚·ã‚¹ãƒ†ãƒ 

**è¦ä»¶:** ãƒãƒ¼ãƒ å…¨ä½“ã§æŠ•ç¥¨ã—ã¦è‡ªå‹•è‡ªæ®ºã‚’åˆ¶å¾¡

| ID | è¦ä»¶ | å„ªå…ˆåº¦ |
|----|------|--------|
| FR-005-1 | æŠ•ç¥¨ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä½œæˆï¼ˆ10ç§’åˆ¶é™ï¼‰ | å¿…é ˆ |
| FR-005-2 | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æŠ•ç¥¨å—ä»˜ | å¿…é ˆ |
| FR-005-3 | éåŠæ•°åˆ¤å®š | å¿…é ˆ |
| FR-005-4 | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ï¼ˆæœªæŠ•ç¥¨=Cancelï¼‰ | å¿…é ˆ |
| FR-005-5 | çµæœåæ˜ ï¼ˆå®Ÿè¡Œ or ã‚¹ã‚­ãƒƒãƒ—ï¼‰ | å¿…é ˆ |

**å—ã‘å…¥ã‚ŒåŸºæº–:**
- âœ… 10ç§’ä»¥å†…ã«æŠ•ç¥¨å®Œäº†
- âœ… éåŠæ•°ä»¥ä¸Šã§å®Ÿè¡Œ
- âœ… æœªæŠ•ç¥¨ã¯å®Ÿè¡Œæ‰±ã„

### éæ©Ÿèƒ½è¦ä»¶

#### NFR-001: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

| é …ç›® | è¦ä»¶ |
|------|------|
| PlayerStateæ›´æ–° | 200msé–“éš” |
| UIæ›´æ–°é »åº¦ | 60fpsï¼ˆ16msï¼‰ |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶ | < 100ms (p95) |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ | < 50MBå¢—åŠ  |

#### NFR-002: å¯ç”¨æ€§

| é …ç›® | è¦ä»¶ |
|------|------|
| æ¥ç¶šæ–­æ™‚ã®è‡ªå‹•å†æ¥ç¶š | 3å›ãƒªãƒˆãƒ©ã‚¤ |
| ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ | ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨ |
| ã‚¨ãƒ©ãƒ¼é€šçŸ¥ | UIä¸Šã«è¡¨ç¤º |

#### NFR-003: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

| é …ç›® | è¦ä»¶ |
|------|------|
| è¨­å®šã®æš—å·åŒ– | LocalStorageæš—å·åŒ– |
| WebSocketèªè¨¼ | Session Token |
| ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ | Backendå´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |

---

## ğŸ“‹ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

### UC-001: å¸Œæœ›ãƒ†ãƒ©ãƒ¼ãŒå‡ºç¾ + çµ±ç‡ã•ã‚Œã‚‹è‡ªæ®ºæœ‰åŠ¹

```
Actor: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆ6äººï¼‰
Preconditions: 
  - player-456, player-789 ãŒã€Œhallway Ã— Silent Crushã€ã‚’ç™»éŒ²
  - è‡ªå‹•è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰: Coordinated
  - ç¾åœ¨ã®ãƒ©ã‚¦ãƒ³ãƒ‰: hallway

Flow:
  1. Backend: Silent Crush å‡ºç¾æ¤œçŸ¥
  2. ToNRoundCounter: ãƒãƒƒãƒãƒ³ã‚°åˆ¤å®š
     â†’ player-456, player-789 ãŒç”Ÿå­˜å¸Œæœ›ã¨åˆ¤å®š
  3. ThreatAlertOverlay è¡¨ç¤º
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ ğŸŒ™ Silent Crush å‡ºç¾!           â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ ğŸ’š player-456 ç”Ÿå­˜å¸Œæœ›          â”‚
     â”‚ ğŸ’š player-789 ç”Ÿå­˜å¸Œæœ›          â”‚
     â”‚                                 â”‚
     â”‚ ğŸ”´ çµ±ç‡ã•ã‚Œã‚‹è‡ªæ®ºãŒæœ‰åŠ¹         â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ [âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«]                 â”‚
     â”‚ [âœ… ç”Ÿå­˜ã‚’ç›®æŒ‡ã™]               â”‚
     â”‚ Time: 5s / 10s                  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  4. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æŠ•ç¥¨
     - player-123: âœ… ç”Ÿå­˜ã‚’ç›®æŒ‡ã™
     - player-456: âœ… ç”Ÿå­˜ã‚’ç›®æŒ‡ã™
     - player-789: âœ… ç”Ÿå­˜ã‚’ç›®æŒ‡ã™
     - player-321: (æœªæŠ•ç¥¨) â†’ ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ‰±ã„
  5. Backend: æŠ•ç¥¨é›†è¨ˆï¼ˆ3/4 = 75% > 50%ï¼‰
  6. æ±ºå®š: ç”Ÿå­˜ã‚’ç›®æŒ‡ã™
  7. AutoSuicideService: ä»Šå‘¨æœŸã®è‡ªæ®ºã‚’ã‚¹ã‚­ãƒƒãƒ—
  8. ãƒãƒ¼ãƒ å…¨ä½“ã§ç”Ÿå­˜ãƒ—ãƒ¬ã‚¤é–‹å§‹

Postconditions:
  - è‡ªå‹•è‡ªæ®ºãŒå®Ÿè¡Œã•ã‚Œãªã„
  - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã§ç”Ÿå­˜å¸Œæœ›è€…ãŒç·‘è‰²è¡¨ç¤º
```

### UC-002: å¸Œæœ›ãƒ†ãƒ©ãƒ¼ãŒå‡ºç¾ + é€šå¸¸ã®è‡ªå‹•è‡ªæ®ºæœ‰åŠ¹

```
Actor: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆå€‹äººï¼‰
Preconditions: 
  - player-456 ãŒã€Œoffice Ã— Duckyã€ã‚’ç™»éŒ²
  - è‡ªå‹•è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰: Individual
  - ç¾åœ¨ã®ãƒ©ã‚¦ãƒ³ãƒ‰: office

Flow:
  1. Backend: Ducky å‡ºç¾æ¤œçŸ¥
  2. ToNRoundCounter: ãƒãƒƒãƒãƒ³ã‚°åˆ¤å®š
     â†’ player-456 ãŒç”Ÿå­˜å¸Œæœ›ã¨åˆ¤å®š
  3. ThreatAlertOverlay è¡¨ç¤º
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ ğŸ¦† Ducky å‡ºç¾!                  â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ ğŸ’š player-456 ç”Ÿå­˜å¸Œæœ›          â”‚
     â”‚                                 â”‚
     â”‚ â„¹ï¸ é€šå¸¸ã®è‡ªå‹•è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰         â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ [âŒ ã‚¹ã‚­ãƒƒãƒ—] [âœ… å®Ÿè¡Œ]        â”‚
     â”‚ Time: 5s / 10s                  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  4. player-456: [âŒ ã‚¹ã‚­ãƒƒãƒ—] é¸æŠ
  5. AutoSuicideService: ä»Šå‘¨æœŸã®è‡ªæ®ºã‚’ã‚¹ã‚­ãƒƒãƒ—
  6. å€‹äººã§ç”Ÿå­˜ãƒ—ãƒ¬ã‚¤

Postconditions:
  - player-456 ã®è‡ªå‹•è‡ªæ®ºãŒå®Ÿè¡Œã•ã‚Œãªã„
  - ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯é€šå¸¸é€šã‚Šå®Ÿè¡Œ
```

### UC-003: å¸Œæœ›ãƒ†ãƒ©ãƒ¼ãŒå‡ºç¾ + æ‰‹å‹•ã®ã¿

```
Actor: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
Preconditions: 
  - player-789 ãŒã€Œ(All) Ã— Piranhasã€ã‚’ç™»éŒ²
  - è‡ªå‹•è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰: Manual

Flow:
  1. Backend: Piranhas å‡ºç¾æ¤œçŸ¥ï¼ˆã©ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚‚ï¼‰
  2. ToNRoundCounter: ãƒãƒƒãƒãƒ³ã‚°åˆ¤å®š
     â†’ player-789 ãŒç”Ÿå­˜å¸Œæœ›ã¨åˆ¤å®š
  3. ThreatAlertOverlay è¡¨ç¤ºï¼ˆ3ç§’ã§è‡ªå‹•é–‰ã˜ï¼‰
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ ğŸŸ Piranhas å‡ºç¾!               â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ ğŸ’š player-789 ç”Ÿå­˜å¸Œæœ›          â”‚
     â”‚ â„¹ï¸ æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰                   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  4. è‡ªå‹•å‡¦ç†ãªã—
  5. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ‰‹å‹•ã§åˆ¤æ–­

Postconditions:
  - é€šçŸ¥ã®ã¿è¡¨ç¤º
  - è‡ªå‹•è‡ªæ®ºã¯å®Ÿè¡Œã•ã‚Œãªã„
```

### UC-004: å¸Œæœ›ã—ã¦ã„ãªã„ãƒ†ãƒ©ãƒ¼å‡ºç¾

```
Actor: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆ6äººï¼‰
Preconditions: 
  - èª°ã‚‚ã€ŒOgreã€ã‚’ç™»éŒ²ã—ã¦ã„ãªã„
  - ç¾åœ¨ã®ãƒ©ã‚¦ãƒ³ãƒ‰: courtyard

Flow:
  1. Backend: Ogre å‡ºç¾æ¤œçŸ¥
  2. ToNRoundCounter: ãƒãƒƒãƒãƒ³ã‚°åˆ¤å®š
     â†’ ç”Ÿå­˜å¸Œæœ›ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ = 0äºº
  3. Backend: RPCé€ä¿¡ãªã—
  4. ToNRoundCounter: é€šçŸ¥ãªã—
  5. é€šå¸¸ã®è‡ªå‹•è‡ªæ®ºãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œ

Postconditions:
  - ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„
  - è‡ªå‹•è‡ªæ®ºè¨­å®šé€šã‚Šã«å®Ÿè¡Œ
```

---

## âš™ï¸ ã»ã—ã„ãƒ†ãƒ©ãƒ¼è¨­å®šä»•æ§˜

### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```csharp
public class WishedTerror
{
    public string Id { get; set; }              // UUID
    public string TerrorName { get; set; }      // e.g. "Silent Crush"
    public string RoundKey { get; set; }        // e.g. "hallway" or ""
    public DateTime CreatedAt { get; set; }
}

public class WishedTerrorPreference
{
    public string PlayerId { get; set; }
    public List<WishedTerror> WishedTerrors { get; set; }
    public DateTime UpdatedAt { get; set; }
}
```

### è¨­å®šä¾‹

| TerrorName | RoundKey | æ„å‘³ |
|-----------|----------|------|
| Silent Crush | "hallway" | ãƒãƒ­ã‚¦ã‚§ã‚¤ãƒ©ã‚¦ãƒ³ãƒ‰ã®Silent Crushã§ã®ã¿ç”Ÿå­˜å¸Œæœ› |
| Silent Crush | "" | ã™ã¹ã¦ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã®Silent Crushã§ç”Ÿå­˜å¸Œæœ› |
| Mr. Hands | "hallway" | ãƒãƒ­ã‚¦ã‚§ã‚¤ãƒ©ã‚¦ãƒ³ãƒ‰ã®Mr.Handsã§ã®ã¿ç”Ÿå­˜å¸Œæœ› |
| Ogre | "" | ã™ã¹ã¦ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã®Ogreã§ç”Ÿå­˜å¸Œæœ› |

### LocalStorageæ°¸ç¶šåŒ–

```json
{
  "wishedTerrors": [
    {
      "id": "uuid-001",
      "terrorName": "Silent Crush",
      "roundKey": "hallway",
      "createdAt": "2025-11-05T10:00:00Z"
    },
    {
      "id": "uuid-002",
      "terrorName": "Silent Crush",
      "roundKey": "",
      "createdAt": "2025-11-05T10:01:00Z"
    },
    {
      "id": "uuid-003",
      "terrorName": "Piranhas",
      "roundKey": "",
      "createdAt": "2025-11-05T10:02:00Z"
    }
  ]
}
```

### ãƒãƒƒãƒãƒ³ã‚°åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

```csharp
public bool IsTerrorMatched(
    WishedTerror wished,
    string currentTerrorName,
    string currentRoundKey)
{
    // ãƒ†ãƒ©ãƒ¼åã¯å¿…ãšãƒãƒƒãƒå¿…é ˆ
    if (wished.TerrorName != currentTerrorName)
        return false;
    
    // ãƒ©ã‚¦ãƒ³ãƒ‰ã‚­ãƒ¼ãŒç©ºç™½ = ã™ã¹ã¦ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã§æœ‰åŠ¹
    if (string.IsNullOrEmpty(wished.RoundKey))
        return true;
    
    // ãƒ©ã‚¦ãƒ³ãƒ‰ã‚­ãƒ¼ãŒæŒ‡å®š = å®Œå…¨ä¸€è‡´ã®ã¿
    return wished.RoundKey == currentRoundKey;
}
```

### ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¤œç´¢

```csharp
private List<string> GetSurvivalWishersForTerror(
    string terrorName,
    string roundKey)
{
    var wishers = new List<string>();
    
    foreach (var player in _instance.Players)
    {
        var preferences = _repo.GetWishedTerrors(player.Id);
        
        foreach (var wished in preferences.WishedTerrors)
        {
            if (IsTerrorMatched(wished, terrorName, roundKey))
            {
                wishers.Add(player.Id);
                break;  // ã“ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯1å›ã ã‘è¿½åŠ 
            }
        }
    }
    
    return wishers;
}
```

---

## ğŸ® ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤

### UI ãƒ‡ã‚¶ã‚¤ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                           â”‚
â”‚ ğŸ“‹ SURVIVAL WISHES                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ ğŸ’š player-456: Diamond + Shield (45dmg)  â”‚
â”‚ ğŸ’š player-789: Hammer (12dmg)            â”‚
â”‚                                           â”‚
â”‚ ğŸ“‹ OTHER MEMBERS                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ âšª player-123: Sword (78dmg)              â”‚
â”‚ âšª player-321: Axe (32dmg)                â”‚
â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ï¼ï¼ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ­»äº¡å¾Œ ï¼ï¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                           â”‚
â”‚ ğŸ“‹ SURVIVAL WISHES                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ ğŸ’š player-456: Diamond + Shield (45dmg)  â”‚
â”‚ ğŸ”´ player-789: Hammer (12dmg)            â”‚ â† èµ¤è‰²
â”‚                                           â”‚
â”‚ ğŸ“‹ OTHER MEMBERS                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ âšª player-123: Sword (78dmg)              â”‚
â”‚ âš« player-321: Axe (32dmg)                â”‚ â† ç°è‰²
â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è‰²åˆ†ã‘ãƒ«ãƒ¼ãƒ«

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ç”Ÿå­˜å¸Œæœ›è€… | ãã®ä»– |
|-----------|---------|--------|
| **ç”Ÿå­˜ä¸­** | ğŸŸ¢ **ç·‘** (#00FF00) | âšª **ç™½** (#FFFFFF) |
| **æ­»äº¡** | ğŸ”´ **èµ¤** (#FF0000) | âš« **ç°è‰²** (#808080) |

### è¡¨ç¤ºå†…å®¹

```
å½¢å¼: åå‰ : ã‚¢ã‚¤ãƒ†ãƒ  (ãƒ€ãƒ¡ãƒ¼ã‚¸)

ä¾‹:
ğŸ’š player-456: Diamond + Shield (45dmg)
ğŸ’š player-789: Hammer (12dmg)
âšª player-123: Sword (78dmg)
ğŸ”´ player-999: Iron Armor (120dmg) â† æ­»äº¡
âš« player-888: Stone Sword (0dmg)   â† æ­»äº¡
```

### å‹•çš„æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°

| ã‚¤ãƒ™ãƒ³ãƒˆ | æ›´æ–°å†…å®¹ |
|---------|---------|
| ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‚åŠ  | ãƒªã‚¹ãƒˆè¿½åŠ  |
| ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é›¢è„± | ãƒªã‚¹ãƒˆå‰Šé™¤ |
| ãƒ€ãƒ¡ãƒ¼ã‚¸å—æ•µ | ãƒ€ãƒ¡ãƒ¼ã‚¸å€¤æ›´æ–° |
| ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ­»äº¡ | è‰²å¤‰æ›´ï¼ˆç·‘â†’èµ¤ or ç™½â†’ç°ï¼‰ |
| ã‚¢ã‚¤ãƒ†ãƒ å¤‰æ›´ | ã‚¢ã‚¤ãƒ†ãƒ è¡¨ç¤ºæ›´æ–° |
| åŒæœŸã‚ªãƒ³/ã‚ªãƒ• | ãƒªã‚¹ãƒˆè¡¨ç¤º/éè¡¨ç¤º |

**æ›´æ–°é »åº¦:** 200ms ã”ã¨

### å®Ÿè£…ã‚³ãƒ¼ãƒ‰

```csharp
public class PlayerListOverlay : Form
{
    private ListBox _survivalWishersListBox;
    private ListBox _otherMembersListBox;
    private readonly IStateService _state;
    private System.Threading.Timer _updateTimer;
    
    public PlayerListOverlay(IStateService state)
    {
        _state = state;
        InitializeUI();
        StartUpdateTimer();
    }
    
    private void InitializeUI()
    {
        // SURVIVAL WISHES ã‚»ã‚¯ã‚·ãƒ§ãƒ³
        var wishersLabel = new Label
        {
            Text = "ğŸ“‹ SURVIVAL WISHES",
            Location = new Point(10, 10),
            Size = new Size(400, 30),
            ForeColor = Color.White
        };
        
        _survivalWishersListBox = new ListBox
        {
            Location = new Point(10, 50),
            Size = new Size(400, 150),
            BackColor = Color.FromArgb(30, 30, 30),
            ForeColor = Color.Lime
        };
        
        // OTHER MEMBERS ã‚»ã‚¯ã‚·ãƒ§ãƒ³
        var othersLabel = new Label
        {
            Text = "ğŸ“‹ OTHER MEMBERS",
            Location = new Point(10, 220),
            Size = new Size(400, 30),
            ForeColor = Color.White
        };
        
        _otherMembersListBox = new ListBox
        {
            Location = new Point(10, 260),
            Size = new Size(400, 150),
            BackColor = Color.FromArgb(30, 30, 30),
            ForeColor = Color.White
        };
        
        Controls.Add(wishersLabel);
        Controls.Add(_survivalWishersListBox);
        Controls.Add(othersLabel);
        Controls.Add(_otherMembersListBox);
    }
    
    private void StartUpdateTimer()
    {
        _updateTimer = new System.Threading.Timer(
            _ => UpdatePlayerList(),
            null,
            TimeSpan.Zero,
            TimeSpan.FromMilliseconds(500)
        );
    }
    
    private void UpdatePlayerList()
    {
        if (InvokeRequired)
        {
            Invoke(new Action(UpdatePlayerList));
            return;
        }
        
        var players = _state.GetInstancePlayers();
        var wishers = _state.GetSurvivalWishers();
        
        // SURVIVAL WISHES æ›´æ–°
        _survivalWishersListBox.Items.Clear();
        foreach (var wisher in wishers)
        {
            var color = wisher.IsAlive ? Color.Lime : Color.Red;
            var item = $"{wisher.Name}: {wisher.Items} ({wisher.Damage}dmg)";
            _survivalWishersListBox.Items.Add(item);
            // è‰²å¤‰æ›´ã¯ DrawMode.OwnerDrawFixed ã§å®Ÿè£…
        }
        
        // OTHER MEMBERS æ›´æ–°
        _otherMembersListBox.Items.Clear();
        var others = players.Except(wishers);
        foreach (var other in others)
        {
            var color = other.IsAlive ? Color.White : Color.Gray;
            var item = $"{other.Name}: {other.Items} ({other.Damage}dmg)";
            _otherMembersListBox.Items.Add(item);
        }
    }
}
```

---

## ğŸ”Œ çµ±ç‡è‡ªå‹•è‡ªæ®ºã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### Domain Models

```csharp
// æŠ•ç¥¨ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³
public class VotingCampaign
{
    public string CampaignId { get; set; }
    public string InstanceId { get; set; }
    public string TerrorName { get; set; }
    public DateTime CreatedAt { get; set; }
    public DateTime ExpiresAt { get; set; }  // 10ç§’å¾Œ
    
    // æŠ•ç¥¨çµæœ
    public List<PlayerVote> Votes { get; set; }
    
    // æœ€çµ‚æ±ºå®š
    public CoordinatedDecision Decision { get; set; }
}

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æŠ•ç¥¨
public class PlayerVote
{
    public string PlayerId { get; set; }
    public CoordinatedDecision Vote { get; set; }
    public DateTime VotedAt { get; set; }
}

// æŠ•ç¥¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³
public enum CoordinatedDecision
{
    Cancel,        // è‡ªæ®ºã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    Proceed,       // è‡ªæ®ºã‚’å®Ÿè¡Œ
    Pending        // æœªæŠ•ç¥¨
}
```

### ã‚µãƒ¼ãƒ“ã‚¹å±¤

```csharp
public class CoordinatedAutoSuicideService
{
    private readonly IWebSocketClient _ws;
    private readonly IEventBus _events;
    private readonly IStateService _state;
    private readonly IEventLogger _logger;
    
    // çµ±ç‡æŠ•ç¥¨é–‹å§‹
    public async Task InitiateVotingAsync(
        string instanceId, 
        string terrorName,
        List<string> survivalWisherIds)
    {
        var campaign = new VotingCampaign
        {
            CampaignId = Guid.NewGuid().ToString(),
            InstanceId = instanceId,
            TerrorName = terrorName,
            CreatedAt = DateTime.UtcNow,
            ExpiresAt = DateTime.UtcNow.AddSeconds(10),
            Votes = new List<PlayerVote>(),
            Decision = CoordinatedDecision.Pending
        };
        
        // Backend ã«æŠ•ç¥¨ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä½œæˆ
        await _ws.SendAsync(new
        {
            rpc = "coordinated.voting.start",
            campaign = campaign
        });
        
        // UI ã«æŠ•ç¥¨ç”»é¢è¡¨ç¤º (ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«)
        _events.Publish(new CoordinatedVotingStartedEvent
        {
            Campaign = campaign,
            SurvivalWisherIds = survivalWisherIds
        });
    }
    
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæŠ•ç¥¨
    public async Task SubmitVoteAsync(
        string campaignId,
        string playerId,
        CoordinatedDecision vote)
    {
        await _ws.SendAsync(new
        {
            rpc = "coordinated.voting.vote",
            campaign_id = campaignId,
            player_id = playerId,
            decision = vote.ToString()
        });
    }
    
    // æŠ•ç¥¨çµæœã‚’åæ˜ ï¼ˆBackend ã‹ã‚‰é€šçŸ¥ï¼‰
    public async Task OnVotingResolvedAsync(
        VotingCampaign campaign)
    {
        var finalDecision = AggregateVotes(campaign.Votes);
        
        _events.Publish(new CoordinatedVotingResolvedEvent
        {
            Campaign = campaign,
            FinalDecision = finalDecision
        });
        
        if (finalDecision == CoordinatedDecision.Proceed)
        {
            await _autoSuicide.ExecuteAsync();
        }
        else
        {
            // Cancel â†’ ä»Šå‘¨æœŸã¯è‡ªæ®ºã—ãªã„
            await _autoSuicide.SkipCurrentCycleAsync();
        }
    }
    
    // æŠ•ç¥¨é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯
    private CoordinatedDecision AggregateVotes(
        List<PlayerVote> votes)
    {
        if (votes.Count == 0)
            return CoordinatedDecision.Cancel;
        
        var proceedCount = votes.Count(v => v.Vote == CoordinatedDecision.Proceed);
        var totalCount = votes.Count;
        
        // éåŠæ•°ä»¥ä¸ŠãŒ Proceed ãªã‚‰å®Ÿè¡Œ
        return (proceedCount * 2 >= totalCount) 
            ? CoordinatedDecision.Proceed 
            : CoordinatedDecision.Cancel;
    }
    
    // 10ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
    public async Task OnVotingTimeoutAsync(string campaignId)
    {
        var campaign = await _repository.GetCampaignAsync(campaignId);
        
        // æœªæŠ•ç¥¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ Cancel ã§é›†è¨ˆ
        foreach (var player in campaign.GetUnvotedPlayers())
        {
            campaign.Votes.Add(new PlayerVote
            {
                PlayerId = player.Id,
                Vote = CoordinatedDecision.Cancel,
                VotedAt = DateTime.UtcNow
            });
        }
        
        await OnVotingResolvedAsync(campaign);
    }
}
```

### ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©

```csharp
// æŠ•ç¥¨é–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆ
public class CoordinatedVotingStartedEvent
{
    public VotingCampaign Campaign { get; set; }
    public List<string> SurvivalWisherIds { get; set; }
    public DateTime Timestamp { get; set; }
}

// æŠ•ç¥¨å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆ
public class CoordinatedVotingResolvedEvent
{
    public VotingCampaign Campaign { get; set; }
    public CoordinatedDecision FinalDecision { get; set; }
    public DateTime Timestamp { get; set; }
}

// çµ±ç‡è‡ªæ®ºå®Ÿè¡Œã‚¤ãƒ™ãƒ³ãƒˆ
public class CoordinatedAutoSuicideExecutedEvent
{
    public string TerrorName { get; set; }
    public CoordinatedDecision Decision { get; set; }
    public DateTime Timestamp { get; set; }
}
```

### AutoSuicideServiceçµ±åˆ

```csharp
public class AutoSuicideService
{
    public enum Mode
    {
        Disabled,           // ç„¡åŠ¹
        Manual,             // æ‰‹å‹•ã®ã¿
        Individual,         // å€‹åˆ¥è‡ªæ®º
        Coordinated         // çµ±ç‡ã•ã‚Œã‚‹è‡ªæ®º
    }
    
    public async Task ExecuteCycleAsync(
        AutoSuicideMode mode,
        ThreatInfo threat)
    {
        if (mode == Mode.Coordinated)
        {
            // çµ±ç‡è‡ªæ®ºãƒ­ã‚¸ãƒƒã‚¯
            await _coordinated.InitiateVotingAsync(
                _instance.Id,
                threat.Name,
                threat.DesiredPlayers
            );
            // â†’ æŠ•ç¥¨å¾…æ©Ÿ
            // â†’ æ±ºå®šå¾…æ©Ÿ
        }
        else if (mode == Mode.Individual)
        {
            // å€‹åˆ¥è‡ªæ®ºãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç”Ÿå­˜å¸Œæœ›è€…é€šçŸ¥ä»˜ãï¼‰
            if (threat.DesiredPlayers.Any())
            {
                await ShowThreatAlertWithButtonsAsync(threat);
                // â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠå¾…æ©Ÿ
            }
            else
            {
                // è‡ªå‹•å®Ÿè¡Œ
                await ExecuteAsync();
            }
        }
        else if (mode == Mode.Manual)
        {
            // æ‰‹å‹•ã®ã¿
            if (threat.DesiredPlayers.Any())
            {
                await ShowThreatAlertNotificationOnlyAsync(threat);
            }
        }
    }
}
```

---

## ğŸ”„ ã‚·ã‚¹ãƒ†ãƒ å‡¦ç†ãƒ•ãƒ­ãƒ¼

### ãƒ†ãƒ©ãƒ¼å‡ºç¾æ™‚ã®ç·åˆåˆ¤å®šãƒ•ãƒ­ãƒ¼

```
Backend: Threatæ¤œçŸ¥ (terrorName, roundKey)
  â†“
ToNRoundCounter: RealTimeSyncServiceå—ä¿¡
  â†“
ğŸ“Š ãƒã‚§ãƒƒã‚¯1: ç”Ÿå­˜å¸Œæœ›ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆãƒãƒƒãƒãƒ³ã‚°çµæœï¼‰å­˜åœ¨ï¼Ÿ
  
  âŒ NO â†’ Backend: RPCé€ä¿¡ãªã—
         â†’ ToNRoundCounter: é€šçŸ¥ãªã—
         â†’ é€šå¸¸ã®è‡ªå‹•è‡ªæ®ºãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œ
  
  âœ… YES â†’ ç”Ÿå­˜å¸Œæœ›ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ã‚Š
         â†“
         ğŸ“Š ãƒã‚§ãƒƒã‚¯2: è‡ªå‹•è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰ã¯ä½•ï¼Ÿ
         
         â”œâ”€ Disabled
         â”‚  â””â”€ ä½•ã‚‚è¡¨ç¤ºã—ãªã„
         â”‚     (è‡ªå‹•è‡ªæ®ºãªã—)
         â”‚
         â”œâ”€ Manual
         â”‚  â””â”€ ğŸ“Œ é€šçŸ¥ã®ã¿è¡¨ç¤º (3ç§’ã§è‡ªå‹•é–‰ã˜)
         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     â”‚ ğŸŒ™ Silent Crush å‡ºç¾!        â”‚
         â”‚     â”‚ ğŸ’š player-456 ç”Ÿå­˜å¸Œæœ›       â”‚
         â”‚     â”‚ ğŸ’š player-789 ç”Ÿå­˜å¸Œæœ›       â”‚
         â”‚     â”‚ â„¹ï¸ æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰                â”‚
         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ Individual
         â”‚  â””â”€ âš ï¸ ãƒœã‚¿ãƒ³ + é€šçŸ¥è¡¨ç¤º (10ç§’)
         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     â”‚ ğŸŒ™ Silent Crush å‡ºç¾!        â”‚
         â”‚     â”‚ ğŸ’š player-456 ç”Ÿå­˜å¸Œæœ›       â”‚
         â”‚     â”‚ ğŸ’š player-789 ç”Ÿå­˜å¸Œæœ›       â”‚
         â”‚     â”‚ â„¹ï¸ é€šå¸¸ã®è‡ªå‹•è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰      â”‚
         â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚     â”‚ [âŒ ã‚¹ã‚­ãƒƒãƒ—] [âœ… å®Ÿè¡Œ]    â”‚
         â”‚     â”‚ Time: 5s / 10s               â”‚
         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚     â†’ Useré¸æŠ or ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
         â”‚
         â””â”€ Coordinated
            â””â”€ ğŸ—³ï¸ æŠ•ç¥¨ + é€šçŸ¥è¡¨ç¤º (10ç§’)
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ ğŸŒ™ Silent Crush å‡ºç¾!        â”‚
               â”‚ ğŸ’š player-456 ç”Ÿå­˜å¸Œæœ›       â”‚
               â”‚ ğŸ’š player-789 ç”Ÿå­˜å¸Œæœ›       â”‚
               â”‚ ğŸ”´ çµ±ç‡ã•ã‚Œã‚‹è‡ªæ®ºãŒæœ‰åŠ¹      â”‚
               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
               â”‚ [âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«]              â”‚
               â”‚ [âœ… ç”Ÿå­˜ã‚’ç›®æŒ‡ã™]            â”‚
               â”‚ Time: 5s / 10s               â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†’ æŠ•ç¥¨é›†è¨ˆ â†’ æ±ºå®šå®Ÿè¡Œ
```

### æŠ•ç¥¨ãƒ•ãƒ­ãƒ¼è©³ç´°

```
1. Backend: Threatæ¤œçŸ¥ (ç”Ÿå­˜å¸Œæœ›è€…ã‚ã‚Š)
   â†“
2. CoordinatedAutoSuicideService.InitiateVotingAsync()
   â†’ VotingCampaign ä½œæˆ
   â†’ EventBus: CoordinatedVotingStartedEvent ç™ºç«
   â†“
3. VotingOverlayPanel: ã‚¤ãƒ™ãƒ³ãƒˆå—ã‘å–ã‚Š
   â†’ æŠ•ç¥¨UI è¡¨ç¤º
   â†“
4. User: [âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«] or [âœ… å®Ÿè¡Œ] ã‚¯ãƒªãƒƒã‚¯
   â†“
5. SubmitVoteAsync()
   â†’ RPC: coordinated.voting.vote
   â†’ Backend: æŠ•ç¥¨é›†è¨ˆ
   â†“
6. Backend: æŠ•ç¥¨ç· åˆ‡ (10ç§’) or å…¨å“¡æŠ•ç¥¨
   â†’ RPC: coordinated.voting.resolved
   â†“
7. ToNRoundCounter: OnVotingResolvedAsync()
   â†’ æŠ•ç¥¨çµæœã«åŸºã¥ãå®Ÿè¡Œ/ã‚­ãƒ£ãƒ³ã‚»ãƒ«
   â†’ EventBus: CoordinatedVotingResolvedEvent ç™ºç«
   â†“
8. AutoSuicideService: æŠ•ç¥¨æ±ºå®šã‚’åæ˜ 
   â†’ å®Ÿè¡Œ or ã‚¹ã‚­ãƒƒãƒ—
```

---

## ğŸ¨ UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 1. ThreatAlertOverlayï¼ˆå”åŠ›åˆ¤å®šç‰ˆï¼‰

#### çµ±ç‡ã•ã‚Œã‚‹è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ™ Silent Crush å‡ºç¾!          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚
â”‚ ğŸ’š player-456 ç”Ÿå­˜å¸Œæœ›        â”‚
â”‚ ğŸ’š player-789 ç”Ÿå­˜å¸Œæœ›        â”‚
â”‚                                â”‚
â”‚ ğŸ”´ çµ±ç‡ã•ã‚Œã‚‹è‡ªæ®ºãŒæœ‰åŠ¹       â”‚
â”‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚
â”‚   [âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«]              â”‚
â”‚   [âœ… ç”Ÿå­˜ã‚’ç›®æŒ‡ã™]            â”‚
â”‚                                â”‚
â”‚ Time: 5s / 10s                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å€‹åˆ¥è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ™ Silent Crush å‡ºç¾!          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚
â”‚ ğŸ’š player-456 ç”Ÿå­˜å¸Œæœ›        â”‚
â”‚ ğŸ’š player-789 ç”Ÿå­˜å¸Œæœ›        â”‚
â”‚                                â”‚
â”‚ â„¹ï¸ é€šå¸¸ã®è‡ªå‹•è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰        â”‚
â”‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚
â”‚   [âŒ ã‚¹ã‚­ãƒƒãƒ—] [âœ… å®Ÿè¡Œ]     â”‚
â”‚                                â”‚
â”‚ Time: 5s / 10s                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰ï¼ˆé€šçŸ¥ã®ã¿ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ™ Silent Crush å‡ºç¾!          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚
â”‚ ğŸ’š player-456 ç”Ÿå­˜å¸Œæœ›        â”‚
â”‚ ğŸ’š player-789 ç”Ÿå­˜å¸Œæœ›        â”‚
â”‚                                â”‚
â”‚ â„¹ï¸ æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰                  â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(3ç§’ã§è‡ªå‹•é–‰ã˜)
```

### 2. SettingsPanel: ã€Œã»ã—ã„ãƒ†ãƒ©ãƒ¼è¨­å®šã€ã‚¿ãƒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloud - ã»ã—ã„ãƒ†ãƒ©ãƒ¼è¨­å®š                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                           â”‚
â”‚ ğŸ’¡ ç”Ÿå­˜å¸Œæœ›é€šçŸ¥å¯¾è±¡ãƒ†ãƒ©ãƒ¼                 â”‚
â”‚    (ãƒ©ã‚¦ãƒ³ãƒ‰ Ã— ãƒ†ãƒ©ãƒ¼å ã®çµ„ã¿åˆã‚ã›)     â”‚
â”‚                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Round  â”‚ Terror Name      â”‚ [Delete]â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ hallwayâ”‚ Silent Crush     â”‚ [  ğŸ—‘ï¸ ]â”‚  â”‚
â”‚ â”‚ hallwayâ”‚ Mr. Hands        â”‚ [  ğŸ—‘ï¸ ]â”‚  â”‚
â”‚ â”‚  (All) â”‚ Piranhas         â”‚ [  ğŸ—‘ï¸ ]â”‚  â”‚
â”‚ â”‚ office â”‚ Ducky            â”‚ [  ğŸ—‘ï¸ ]â”‚  â”‚
â”‚ â”‚  (All) â”‚ Ogre             â”‚ [  ğŸ—‘ï¸ ]â”‚  â”‚
â”‚ â”‚        â”‚                  â”‚         â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ Round:   [hallwayâ–¼]                 â”‚  â”‚
â”‚ â”‚ Terror:  [Silent Crush     â–¼]      â”‚  â”‚
â”‚ â”‚          [Add]                      â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                           â”‚
â”‚ ğŸ’¾ [ä¿å­˜]  ğŸ”„ [ãƒªã‚»ãƒƒãƒˆ]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é¸æŠè‚¢

**Round ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³:**
```
- (All) â† ãƒ©ã‚¦ãƒ³ãƒ‰æŒ‡å®šãªã—ï¼ˆã™ã¹ã¦ã®ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
- hallway
- office
- darkroom
- cafeteria
- library
- courtyard
```

**Terror ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³:**
```
- (Select)
- Silent Crush
- Mr. Hands
- Piranhas
- Ducky
- Ogre
- Leo
- Hanny & Lanny
- Rig
- Gummer
- Aloe Vera
- Yoo & Boyo
- Tiramisu
- Fart Filter
- Spider/Boy
- Sly Marbo
```

---

## ğŸ’» å®Ÿè£…ä»•æ§˜

### Phase 1: åŸºç›¤ (1é€±é–“)

#### ã‚¿ã‚¹ã‚¯ä¸€è¦§

- [ ] WishedTerror Domain å®šç¾©
- [ ] IAppSettings ã« ã»ã—ã„ãƒ†ãƒ©ãƒ¼ è¨­å®šè¿½åŠ 
- [ ] LocalStorage æ°¸ç¶šåŒ– (JSON)
- [ ] SettingsPanel UI å®Ÿè£… (ãƒ†ãƒ¼ãƒ–ãƒ« + Add/Delete)

#### å®Ÿè£…ã‚³ãƒ¼ãƒ‰ä¾‹

```csharp
// IAppSettings æ‹¡å¼µ
public interface IAppSettings
{
    // æ—¢å­˜è¨­å®š...
    
    // ã»ã—ã„ãƒ†ãƒ©ãƒ¼è¨­å®š
    List<WishedTerror> WishedTerrors { get; set; }
    void SaveWishedTerrors(List<WishedTerror> terrors);
    List<WishedTerror> LoadWishedTerrors();
}

// SettingsRepository å®Ÿè£…
public class SettingsRepository : ISettingsRepository
{
    private readonly string _settingsPath = "settings.json";
    
    public void SaveWishedTerrors(List<WishedTerror> terrors)
    {
        var json = JsonConvert.SerializeObject(new
        {
            wishedTerrors = terrors
        });
        
        File.WriteAllText(_settingsPath, json);
    }
    
    public List<WishedTerror> LoadWishedTerrors()
    {
        if (!File.Exists(_settingsPath))
            return new List<WishedTerror>();
        
        var json = File.ReadAllText(_settingsPath);
        var obj = JsonConvert.DeserializeObject<dynamic>(json);
        
        return obj.wishedTerrors.ToObject<List<WishedTerror>>();
    }
}
```

### Phase 2: ãƒãƒƒãƒãƒ³ã‚° & æ¤œç´¢ (1é€±é–“)

#### ã‚¿ã‚¹ã‚¯ä¸€è¦§

- [ ] `GetSurvivalWishersForTerror()` å®Ÿè£…
- [ ] `IsTerrorMatched()` ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ (8ãƒ‘ã‚¿ãƒ¼ãƒ³)

### Phase 3: é€šçŸ¥ãƒ•ãƒ­ãƒ¼ (1é€±é–“)

#### ã‚¿ã‚¹ã‚¯ä¸€è¦§

- [ ] RealTimeSyncService: threat.announced å—ä¿¡
- [ ] ç”Ÿå­˜å¸Œæœ›ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ 0 äºº â†’ é€šçŸ¥ãªã—
- [ ] ç”Ÿå­˜å¸Œæœ›ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ > 0 â†’ ThreatAlertOverlay è¡¨ç¤º

### Phase 4: UI & ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ (1é€±é–“)

#### ã‚¿ã‚¹ã‚¯ä¸€è¦§

- [ ] ThreatAlertOverlay ãƒœã‚¿ãƒ³è¡¨ç¤º/éè¡¨ç¤º
- [ ] 10ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå®Ÿè£…
- [ ] è‡ªå‹•é–‰ã˜
- [ ] PlayerListOverlay å®Ÿè£…

### Phase 5: æŠ•ç¥¨é€£æº (1é€±é–“)

#### ã‚¿ã‚¹ã‚¯ä¸€è¦§

- [ ] CoordinatedAutoSuicideService: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã® Cancel é›†è¨ˆ
- [ ] IndividualAutoSuicideService: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã® Skip
- [ ] E2E ãƒ†ã‚¹ãƒˆ

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆä»•æ§˜

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

#### TEST-001: ãƒãƒƒãƒãƒ³ã‚°åˆ¤å®š

```csharp
[TestClass]
public class WishedTerrorMatchingTests
{
    [TestMethod]
    public void WishedTerror_RoundAndTerrorMatch()
    {
        // Arrange
        var wished = new WishedTerror
        {
            TerrorName = "Silent Crush",
            RoundKey = "hallway"
        };
        
        // Act
        bool result = IsTerrorMatched(wished, "Silent Crush", "hallway");
        
        // Assert
        Assert.IsTrue(result);
    }
    
    [TestMethod]
    public void WishedTerror_NoRound_MatchesAll()
    {
        // Arrange
        var wished = new WishedTerror
        {
            TerrorName = "Silent Crush",
            RoundKey = ""
        };
        
        // Act & Assert
        Assert.IsTrue(IsTerrorMatched(wished, "Silent Crush", "hallway"));
        Assert.IsTrue(IsTerrorMatched(wished, "Silent Crush", "office"));
        Assert.IsTrue(IsTerrorMatched(wished, "Silent Crush", ""));
    }
    
    [TestMethod]
    public void WishedTerror_DifferentTerror_NoMatch()
    {
        // Arrange
        var wished = new WishedTerror
        {
            TerrorName = "Silent Crush",
            RoundKey = "hallway"
        };
        
        // Act
        bool result = IsTerrorMatched(wished, "Ogre", "hallway");
        
        // Assert
        Assert.IsFalse(result);
    }
    
    [TestMethod]
    public void WishedTerror_DifferentRound_NoMatch()
    {
        // Arrange
        var wished = new WishedTerror
        {
            TerrorName = "Silent Crush",
            RoundKey = "hallway"
        };
        
        // Act
        bool result = IsTerrorMatched(wished, "Silent Crush", "office");
        
        // Assert
        Assert.IsFalse(result);
    }
}
```

#### TEST-002: æŠ•ç¥¨é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯

```csharp
[TestClass]
public class VotingAggregationTests
{
    [TestMethod]
    public void Voting_Majority_Proceed()
    {
        // Arrange
        var votes = new List<PlayerVote>
        {
            new PlayerVote { Vote = CoordinatedDecision.Proceed },
            new PlayerVote { Vote = CoordinatedDecision.Proceed },
            new PlayerVote { Vote = CoordinatedDecision.Proceed },
            new PlayerVote { Vote = CoordinatedDecision.Cancel }
        };
        
        // Act
        var result = AggregateVotes(votes);
        
        // Assert
        Assert.AreEqual(CoordinatedDecision.Proceed, result);
    }
    
    [TestMethod]
    public void Voting_Minority_Cancel()
    {
        // Arrange
        var votes = new List<PlayerVote>
        {
            new PlayerVote { Vote = CoordinatedDecision.Proceed },
            new PlayerVote { Vote = CoordinatedDecision.Cancel },
            new PlayerVote { Vote = CoordinatedDecision.Cancel },
            new PlayerVote { Vote = CoordinatedDecision.Cancel }
        };
        
        // Act
        var result = AggregateVotes(votes);
        
        // Assert
        Assert.AreEqual(CoordinatedDecision.Cancel, result);
    }
    
    [TestMethod]
    public void Voting_NoVotes_Cancel()
    {
        // Arrange
        var votes = new List<PlayerVote>();
        
        // Act
        var result = AggregateVotes(votes);
        
        // Assert
        Assert.AreEqual(CoordinatedDecision.Cancel, result);
    }
}
```

### E2Eãƒ†ã‚¹ãƒˆ

#### TEST-E2E-001: çµ±ç‡è‡ªæ®ºãƒ•ãƒ­ãƒ¼

```
Scenario: ç”Ÿå­˜å¸Œæœ›ãƒ†ãƒ©ãƒ¼å‡ºç¾ â†’ æŠ•ç¥¨ â†’ å®Ÿè¡Œ
Given: player-456, player-789 ãŒã€Œhallway Ã— Silent Crushã€ã‚’ç™»éŒ²
  And: è‡ªå‹•è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰ = Coordinated
  And: ç¾åœ¨ã®ãƒ©ã‚¦ãƒ³ãƒ‰ = hallway
When: Silent Crush å‡ºç¾
Then: ThreatAlertOverlay ãŒè¡¨ç¤ºã•ã‚Œã‚‹
  And: ã€Œplayer-456, player-789 ç”Ÿå­˜å¸Œæœ›ã€ã¨è¡¨ç¤º
  And: æŠ•ç¥¨ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
When: player-456 ãŒ [âœ… ç”Ÿå­˜ã‚’ç›®æŒ‡ã™] ã‚’é¸æŠ
  And: player-789 ãŒ [âœ… ç”Ÿå­˜ã‚’ç›®æŒ‡ã™] ã‚’é¸æŠ
  And: player-123 ãŒ [âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«] ã‚’é¸æŠ
  And: player-321 ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ (æœªæŠ•ç¥¨)
Then: æŠ•ç¥¨é›†è¨ˆ = Proceed (2/4 = 50%)
  And: AutoSuicideService ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹
  And: ãƒãƒ¼ãƒ å…¨ä½“ã§ç”Ÿå­˜ãƒ—ãƒ¬ã‚¤é–‹å§‹
```

#### TEST-E2E-002: å€‹åˆ¥è‡ªæ®ºãƒ•ãƒ­ãƒ¼

```
Scenario: ç”Ÿå­˜å¸Œæœ›ãƒ†ãƒ©ãƒ¼å‡ºç¾ â†’ å€‹äººåˆ¤æ–­ â†’ ã‚¹ã‚­ãƒƒãƒ—
Given: player-456 ãŒã€Œoffice Ã— Duckyã€ã‚’ç™»éŒ²
  And: è‡ªå‹•è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰ = Individual
  And: ç¾åœ¨ã®ãƒ©ã‚¦ãƒ³ãƒ‰ = office
When: Ducky å‡ºç¾
Then: ThreatAlertOverlay ãŒè¡¨ç¤ºã•ã‚Œã‚‹
  And: ã€Œplayer-456 ç”Ÿå­˜å¸Œæœ›ã€ã¨è¡¨ç¤º
  And: [ã‚¹ã‚­ãƒƒãƒ—] [å®Ÿè¡Œ] ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
When: player-456 ãŒ [âŒ ã‚¹ã‚­ãƒƒãƒ—] ã‚’é¸æŠ
Then: player-456 ã®è‡ªå‹•è‡ªæ®ºãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹
  And: ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯é€šå¸¸é€šã‚Šå®Ÿè¡Œ
```

#### TEST-E2E-003: ç”Ÿå­˜å¸Œæœ›è€…ãªã—

```
Scenario: ç™»éŒ²ã—ã¦ã„ãªã„ãƒ†ãƒ©ãƒ¼å‡ºç¾ â†’ é€šçŸ¥ãªã— â†’ é€šå¸¸ãƒ•ãƒ­ãƒ¼
Given: èª°ã‚‚ã€ŒOgreã€ã‚’ç™»éŒ²ã—ã¦ã„ãªã„
  And: è‡ªå‹•è‡ªæ®ºãƒ¢ãƒ¼ãƒ‰ = Coordinated
When: Ogre å‡ºç¾
Then: Backend ã¯ RPC ã‚’é€ä¿¡ã—ãªã„
  And: ToNRoundCounter ã¯é€šçŸ¥ã‚’å—ã‘å–ã‚‰ãªã„
  And: ThreatAlertOverlay ã¯è¡¨ç¤ºã•ã‚Œãªã„
  And: é€šå¸¸ã®è‡ªå‹•è‡ªæ®ºãƒ­ã‚¸ãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹
```

---

## ğŸ“Š Backendé€šä¿¡ä»•æ§˜

### RPC: `threat.announced`

ç”Ÿå­˜å¸Œæœ›ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼**ãŒã„ã‚‹å ´åˆã®ã¿** é€ä¿¡

```json
{
  "id": "threat_announced_hallway_sc_001",
  "rpc": "threat.announced",
  "params": {
    "terror_name": "Silent Crush",
    "round_key": "hallway",
    "instance_id": "inst_456",
    "desire_players": [
      {
        "player_id": "player_456",
        "player_name": "Alice"
      },
      {
        "player_id": "player_789",
        "player_name": "Bob"
      }
    ],
    "timestamp": "2025-11-05T10:30:45Z"
  }
}
```

### RPC: `threat.response`

```json
{
  "id": "threat_response_123",
  "rpc": "threat.response",
  "params": {
    "threat_id": "threat_announced_hallway_sc_001",
    "player_id": "player_123",
    "decision": "survive",
    "timestamp": "2025-11-05T10:30:48Z"
  }
}
```

**`decision` ã®å€¤:**
- `"survive"` â†’ [âœ… ç”Ÿå­˜ã‚’ç›®æŒ‡ã™] é¸æŠ
- `"cancel"` â†’ [âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«] é¸æŠ
- `"skip"` â†’ [âŒ ã‚¹ã‚­ãƒƒãƒ—] é¸æŠ
- `"execute"` â†’ [âœ… å®Ÿè¡Œ] é¸æŠ
- `"timeout"` â†’ 10ç§’ä»¥å†…ã«é¸æŠã—ãªã‹ã£ãŸ (è‡ªå‹•ã‚­ãƒ£ãƒ³ã‚»ãƒ«)

### RPC: `coordinated.voting.start`

```json
{
  "rpc": "coordinated.voting.start",
  "params": {
    "campaign_id": "campaign_123",
    "instance_id": "inst_456",
    "terror_name": "Silent Crush",
    "expires_at": "2025-11-05T10:31:00Z"
  }
}
```

### RPC: `coordinated.voting.vote`

```json
{
  "rpc": "coordinated.voting.vote",
  "params": {
    "campaign_id": "campaign_123",
    "player_id": "player_456",
    "decision": "Proceed"
  }
}
```

### RPC: `coordinated.voting.resolved`

```json
{
  "rpc": "coordinated.voting.resolved",
  "params": {
    "campaign_id": "campaign_123",
    "final_decision": "Proceed",
    "votes": [
      {
        "player_id": "player_456",
        "decision": "Proceed"
      },
      {
        "player_id": "player_789",
        "decision": "Proceed"
      },
      {
        "player_id": "player_123",
        "decision": "Cancel"
      },
      {
        "player_id": "player_321",
        "decision": "Cancel"
      }
    ],
    "timestamp": "2025-11-05T10:31:00Z"
  }
}
```

---

## â±ï¸ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»•æ§˜

### æŠ•ç¥¨æ™‚é–“: 10ç§’

| ã‚¤ãƒ™ãƒ³ãƒˆ | ã‚¿ã‚¤ãƒ  | å‹•ä½œ |
|---------|--------|------|
| ãƒœã‚¿ãƒ³è¡¨ç¤ºé–‹å§‹ | 0s | ThreatAlertOverlay å‡ºç¾ |
| ãƒœã‚¿ãƒ³æœ‰åŠ¹ | 0-10s | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠå¯èƒ½ |
| ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ– | 10s | è‡ªå‹•ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ |
| UIè‡ªå‹•é–‰ã˜ | 11s | ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤æ¶ˆãˆã‚‹ |

### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã®å‡¦ç†

```csharp
public async Task OnThreatAlertTimeoutAsync(string threatId)
{
    var threat = await _repo.GetThreatAsync(threatId);
    
    if (threat.Mode == ThreatAlertMode.Coordinated)
    {
        // æŠ•ç¥¨ãƒ¢ãƒ¼ãƒ‰: æœªæŠ•ç¥¨ã‚’ Cancel ã§é›†è¨ˆ
        var campaign = await _voting.GetCampaignAsync(threatId);
        await _voting.OnVotingTimeoutAsync(campaign);
    }
    else if (threat.Mode == ThreatAlertMode.Individual)
    {
        // å€‹åˆ¥ãƒ¢ãƒ¼ãƒ‰: ã‚¹ã‚­ãƒƒãƒ—æ‰±ã„
        await _autoSuicide.SkipCurrentCycleAsync();
    }
    
    // UIè‡ªå‹•é–‰ã˜
    await _ui.CloseAlertAsync();
}
```

---

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: åŸºç›¤

- [ ] WishedTerror Domain å®šç¾©
- [ ] IAppSettings ã« ã»ã—ã„ãƒ†ãƒ©ãƒ¼ è¨­å®šè¿½åŠ 
- [ ] LocalStorage æ°¸ç¶šåŒ– (JSON)
- [ ] SettingsPanel UI å®Ÿè£… (ãƒ†ãƒ¼ãƒ–ãƒ« + Add/Delete)

### Phase 2: ãƒãƒƒãƒãƒ³ã‚° & æ¤œç´¢

- [ ] `GetSurvivalWishersForTerror()` å®Ÿè£…
- [ ] `IsTerrorMatched()` ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ (8ãƒ‘ã‚¿ãƒ¼ãƒ³)

### Phase 3: é€šçŸ¥ãƒ•ãƒ­ãƒ¼

- [ ] RealTimeSyncService: threat.announced å—ä¿¡
- [ ] ç”Ÿå­˜å¸Œæœ›ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ 0 äºº â†’ é€šçŸ¥ãªã—
- [ ] ç”Ÿå­˜å¸Œæœ›ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ > 0 â†’ ThreatAlertOverlay è¡¨ç¤º

### Phase 4: UI & ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

- [ ] ThreatAlertOverlay ãƒœã‚¿ãƒ³è¡¨ç¤º/éè¡¨ç¤º
- [ ] 10ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå®Ÿè£…
- [ ] è‡ªå‹•é–‰ã˜
- [ ] PlayerListOverlay å®Ÿè£…

### Phase 5: æŠ•ç¥¨é€£æº

- [ ] CoordinatedAutoSuicideService: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã® Cancel é›†è¨ˆ
- [ ] IndividualAutoSuicideService: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã® Skip
- [ ] E2E ãƒ†ã‚¹ãƒˆ

---

## ğŸ¯ ã¾ã¨ã‚

| é …ç›® | ä»•æ§˜ |
|------|------|
| **æŠ•ç¥¨æ™‚é–“** | 10ç§’ |
| **è¡¨ç¤ºæ¡ä»¶** | ç”Ÿå­˜å¸Œæœ›ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ > 0 |
| **ãƒ©ã‚¦ãƒ³ãƒ‰æŒ‡å®š** | "hallway" = ç‰¹å®šãƒ©ã‚¦ãƒ³ãƒ‰ã€"" = ã™ã¹ã¦ã®ãƒ©ã‚¦ãƒ³ãƒ‰ |
| **ãƒãƒƒãƒãƒ³ã‚°** | ãƒ†ãƒ©ãƒ¼åå¿…é ˆ + ãƒ©ã‚¦ãƒ³ãƒ‰ä¸€è‡´ (OR ç©ºç™½) |
| **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ** | 10ç§’ â†’ æŠ•ç¥¨ã¯ Cancelã€å€‹åˆ¥ã¯ Skip |
| **é€šçŸ¥ã®ã¿** | æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰: 3ç§’ã§è‡ªå‹•é–‰ã˜ |
| **è‰²åˆ†ã‘** | ç”Ÿå­˜å¸Œæœ›è€…ï¼ˆç·‘/èµ¤ï¼‰ã€ãã®ä»–ï¼ˆç™½/ç°è‰²ï¼‰ |
| **æ›´æ–°é »åº¦** | PlayerList: 200ms |
| **æŠ•ç¥¨é›†è¨ˆ** | éåŠæ•°ä»¥ä¸Šã§ Proceed |

---


**END OF DOCUMENT**
